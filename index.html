<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>صانع صور الشورتس الإخبارية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&family=Cairo:wght@400;700;900&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* Custom CSS to replace Tailwind classes and introduce new design */
    :root {
      --bg-dark: #1a202c; /* Deeper dark for background */
      --bg-panel: #2d3748; /* Slightly lighter for panels */
      --bg-card: #2f3b4d; /* Background for individual cards/sections within panel */
      --bg-accordion: #3a475a; /* Even lighter for accordion summary */
      --border-color: #4a5568; /* Darker border */
      --text-light: #edf2f7; /* Off-white for general text */
      --text-muted: #a0aec0; /* Lighter gray for labels */
      --text-placeholder: #718096; /* Gray for placeholders */
      --blue-main: #3498db; /* A vibrant blue */
      --blue-hover: #2980b9; /* Darker blue on hover */
      --blue-accent: #60a5fa; /* Lighter blue for highlights */
      --blue-gradient-from: #3498db;
      --blue-gradient-to: #2ecc71; /* Greenish teal for contrast */
      --button-gradient-from: #3498db;
      --button-gradient-to: #2ecc71;
      --button-hover-from: #2980b9;
      --button-hover-to: #27ae60;
      --red-heart: #e74c3c;
      --yellow-star: #f1c40f;
      --shadow-light: rgba(0, 0, 0, 0.15);
      --shadow-dark: rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: 'Cairo', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      margin: 0;
      padding: 0;
      direction: rtl;
      line-height: 1.6;
    }

    main {
      min-height: 100vh;
      padding: 1rem;
    }
    @media (min-width: 640px) {
      main { padding: 1.5rem; }
    }
    @media (min-width: 1024px) {
      main { padding: 2rem; }
    }

    .container {
      max-width: 80rem;
      margin-left: auto;
      margin-right: auto;
    }

    header {
      text-align: center;
      margin-bottom: 2.5rem; /* Increased margin for better separation */
    }

    .main-title {
      font-size: 2.5rem; /* Slightly larger */
      line-height: 1.2;
      font-weight: 800;
      background-image: linear-gradient(to right, var(--blue-gradient-from), var(--blue-gradient-to));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.025em; /* Slightly tighter */
    }
    @media (min-width: 640px) {
      .main-title { font-size: 3.5rem; }
    }

    .subtitle {
      margin-top: 0.75rem;
      font-size: 1.25rem; /* Slightly larger */
      line-height: 1.5;
      color: var(--text-muted);
    }

    .flex-container {
      display: flex;
      flex-direction: column;
      gap: 2.5rem; /* Increased gap */
    }
    @media (min-width: 1024px) {
      .flex-container { flex-direction: row; }
    }

    /* Controls Panel - NEW DESIGN */
    .controls-panel {
      width: 100%;
      background-color: var(--bg-panel);
      padding: 1.5rem;
      border-radius: 1.25rem; /* More rounded */
      box-shadow: 0 10px 20px var(--shadow-dark); /* Deeper shadow */
      border: 1px solid var(--border-color);
    }
    @media (min-width: 1024px) {
      .controls-panel { width: 33.333333%; }
    }

    .panel-title {
      font-size: 1.75rem; /* Slightly larger */
      font-weight: 700;
      margin-bottom: 1.5rem; /* More spacing */
      color: var(--blue-accent); /* Highlighted title */
    }

    .space-y-4 > *:not(:last-child) { /* Adjusted spacing */
      margin-bottom: 1rem;
    }

    /* Accordion - Card Style */
    details > summary {
      list-style: none;
    }
    details > summary::-webkit-details-marker {
      display: none;
    }
    details[open] > summary svg {
      transform: rotate(180deg);
    }

    .accordion-item {
      background-color: var(--bg-card); /* Card background */
      border-radius: 0.75rem; /* Rounded corners for cards */
      overflow: hidden;
      box-shadow: 0 4px 8px var(--shadow-light); /* Card shadow */
      transition: all 0.2s ease-in-out;
    }
    .accordion-item:hover {
        box-shadow: 0 6px 12px var(--shadow-dark);
    }


    .accordion-summary {
      padding: 1rem 1.25rem; /* More padding */
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--bg-accordion); /* Distinct background for summary */
      border-bottom: 1px solid var(--border-color); /* Separator */
      color: var(--text-light);
      transition: background-color 0.2s ease-in-out;
    }
    .accordion-summary:hover {
        background-color: #4a5568; /* Darker on hover */
    }
    .accordion-summary svg {
        transition: transform 0.2s ease-in-out;
        color: var(--blue-accent);
    }
    .accordion-summary span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .accordion-summary .icon {
        color: var(--blue-accent);
    }

    .accordion-content {
      padding: 1.25rem; /* More padding */
      border-top: none; /* No top border now */
    }
    .accordion-content > *:not(:last-child) {
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.9rem; /* Slightly larger */
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 0.5rem; /* More spacing */
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      background-color: #242d3b; /* Darker input background */
      border: 1px solid #4a5568;
      border-radius: 0.5rem; /* More rounded inputs */
      padding: 0.6rem 0.8rem; /* Adjusted padding */
      color: var(--text-light);
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--blue-main);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3); /* Blue shadow */
    }

    .color-input {
      width: 100%;
      height: 2.8rem; /* Slightly taller */
      padding: 0.2rem;
      background-color: #242d3b;
      border: 1px solid #4a5568;
      border-radius: 0.5rem;
      cursor: pointer;
    }

    .range-input {
      width: 100%;
      height: 0.4rem; /* Thinner range */
      background-color: #4a5568;
      border-radius: 0.25rem; /* Rounded track */
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }
    .range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 1.2rem; /* Larger thumb */
      height: 1.2rem;
      border-radius: 50%;
      background: var(--blue-main);
      cursor: pointer;
      margin-top: -0.4rem; /* Adjust to center the thumb */
      box-shadow: 0 0 0 3px var(--bg-card); /* Accent border around thumb */
      transition: background-color 0.2s ease-in-out;
    }
    .range-input::-webkit-slider-thumb:hover {
        background-color: var(--blue-hover);
    }
    .range-input::-moz-range-thumb {
      width: 1.2rem;
      height: 1.2rem;
      border-radius: 50%;
      background: var(--blue-main);
      cursor: pointer;
      box-shadow: 0 0 0 3px var(--bg-card);
      transition: background-color 0.2s ease-in-out;
    }
    .range-input::-moz-range-thumb:hover {
        background-color: var(--blue-hover);
    }

    .file-input-label {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem; /* More gap */
      background-color: var(--blue-main);
      color: white;
      font-weight: 700;
      padding: 1.25rem; /* More padding */
      border-radius: 0.6rem; /* More rounded */
      cursor: pointer;
      transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.2s ease-in-out;
      border: 2px dashed var(--blue-accent);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .file-input-label:hover {
      background-color: var(--blue-hover);
      border-color: #85c1e9; /* Lighter blue on hover */
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .file-input-label-small {
      padding: 0.75rem 1rem;
      flex-direction: row;
    }
    .hidden {
      display: none !important;
    }

    .grid-cols-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1rem;
    }
    .grid-cols-2.gap-2 {
      gap: 0.5rem;
    }

    .text-shadow-section {
      border-top: 1px solid var(--border-color);
      padding-top: 1.25rem;
      margin-top: 1.25rem; /* Added margin-top */
    }
    .text-shadow-section h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--blue-accent);
      margin-bottom: 0.75rem;
    }
    .text-shadow-control {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .text-shadow-control .flex-grow {
      flex-grow: 1;
    }
    .text-shadow-control label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    /* Buttons for logo position */
    .btn {
      padding: 0.6rem 0.8rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      border: none;
    }
    .btn-primary {
      background-color: var(--blue-main);
      color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .btn-primary:hover {
      background-color: var(--blue-hover);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .btn-secondary {
      background-color: var(--bg-accordion);
      color: var(--text-light);
    }
    .btn-secondary:hover {
      background-color: #4a5568;
    }
    .btn-sm {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
    }


    /* Preview Panel */
    .preview-panel-wrapper {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    @media (min-width: 1024px) {
      .preview-panel-wrapper { width: 66.666667%; }
    }

    .image-preview {
      width: 100%;
      max-width: 405px;
      aspect-ratio: 9 / 16;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding: 1.5rem;
      gap: 0.75rem;
      transition: all 0.5s ease-in-out;
      border-radius: 1.5rem; /* More rounded preview */
    }
    @media (min-width: 640px) {
      .image-preview { padding: 2rem; }
    }

    .preview-section-box {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
      backdrop-filter: blur(10px); /* Stronger blur */
      padding: 0.75rem 1rem;
      border-radius: 0.75rem; /* More rounded */
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Subtle shadow */
    }

    .preview-headline {
      font-weight: 900;
      text-align: center;
      width: 100%;
      line-height: 1.2;
    }

    .preview-body {
      font-weight: 500;
      text-align: center;
      width: 100%;
      line-height: 1.5;
    }

    .divider {
      height: 1px;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
      background-color: rgba(96, 165, 250, 0.4); /* Slightly stronger divider */
    }

    .main-image-container {
      position: relative;
      width: 100%;
      margin-top: auto;
      margin-bottom: auto;
      flex-grow: 1;
      border-radius: 1rem; /* More rounded */
      overflow: hidden;
      background-color: rgba(55, 65, 81, 0.6); /* Slightly darker placeholder */
      border: 2px solid rgba(55, 65, 81, 0.6);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .preview-main-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.3s ease-in-out;
    }

    .main-image-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-placeholder);
      text-align: center;
      padding: 1rem;
    }

    .logo-container {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.4); /* Slightly darker logo background */
      backdrop-filter: blur(6px); /* Stronger blur */
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.3); /* Stronger border */
      transition: all 0.3s ease-in-out;
    }
    .logo-container.top-right { top: 1rem; right: 1rem; }
    .logo-container.top-left { top: 1rem; left: 1rem; }
    .logo-container.bottom-right { bottom: 1rem; right: 1rem; }
    .logo-container.bottom-left { bottom: 1rem; left: 1rem; }

    .preview-logo {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2)); /* Stronger drop shadow */
    }

    /* CTA (Like & Subscribe) */
    .cta-container {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.25rem; /* More gap */
      color: white;
      font-weight: 600;
      font-size: 0.9rem; /* Slightly larger */
      padding-top: 1rem;
    }

    .cta-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .cta-divider {
      height: 1.5rem; /* Taller divider */
      width: 1px;
      background-color: rgba(255, 255, 255, 0.4); /* Stronger divider */
    }

    .icon-heart { color: var(--red-heart); }
    .icon-star { color: var(--yellow-star); }

    .text-shadow-effect {
        text-shadow: 0 1px 4px rgba(0,0,0,0.6); /* Stronger text shadow */
    }

    /* Export Button */
    .export-btn {
      margin-top: 1.5rem;
      width: 100%;
      max-width: 405px;
      background-image: linear-gradient(to right, var(--button-gradient-from), var(--button-gradient-to));
      color: white;
      font-weight: 700;
      padding: 0.9rem 1.8rem; /* More padding */
      border-radius: 0.75rem; /* More rounded */
      font-size: 1.2rem; /* Larger font */
      transition: transform 0.2s ease-in-out, background-image 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .export-btn:hover {
      transform: scale(1.03); /* Slightly less aggressive scale */
      background-image: linear-gradient(to right, var(--button-hover-from), var(--button-hover-to));
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    .export-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .export-btn svg {
      height: 1.6rem; /* Slightly larger icon */
      width: 1.6rem;
      display: inline-block;
      margin-left: 0.6rem; /* More margin */
    }

    /* Loading Spinner */
    .spinner {
      animation: spin 1s linear infinite;
      -webkit-animation: spin 1s linear infinite;
      margin-left: -0.25rem;
      margin-right: 0.75rem;
      height: 1.4rem; /* Slightly larger spinner */
      width: 1.4rem;
      color: white;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @-webkit-keyframes spin {
      from { -webkit-transform: rotate(0deg); }
      to { -webkit-transform: rotate(360deg); }
    }

    /* Palette buttons */
    .palette-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      width: 100%;
      padding: 0.6rem; /* More padding */
      border-radius: 0.5rem;
      transition: all 0.2s ease-in-out;
      border: 1px solid transparent; /* default border */
    }
    .palette-btn-default {
        background-color: #3f4e62; /* Slightly different gray for palettes */
        color: var(--text-muted);
    }
    .palette-btn-default:hover {
        background-color: #4a5a6e;
    }
    .palette-btn-active {
        background-color: rgba(52, 152, 219, 0.2); /* Lighter blue background */
        box-shadow: 0 0 0 2px var(--blue-main); /* Blue ring */
        border-color: var(--blue-main);
        color: var(--text-light);
    }

    .palette-color-box {
      width: 2.2rem; /* Slightly larger */
      height: 2.2rem;
      border-radius: 0.4rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      flex-shrink: 0;
    }
    .palette-name {
      font-size: 0.9rem;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <main>
    <div class="container">
      <header>
        <h1 class="main-title">
          صانع صور الشورتس الإخبارية
        </h1>
        <p class="subtitle">
          أنشئ صورًا احترافية وجذابة لفيديوهاتك القصيرة بسهولة.
        </p>
      </header>

      <div class="flex-container">
        <!-- Controls Panel -->
        <div class="controls-panel">
          <h2 class="panel-title">لوحة التحكم</h2>
          
          <div class="space-y-4"> <!-- Changed to space-y-4 for consistent card spacing -->
            <!-- Accordion: Content -->
            <details class="accordion-item" open>
              <summary class="accordion-summary">
                <span class="flex items-center gap-2">
                  <svg class="icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                  <span>المحتوى</span>
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </summary>
              <div class="accordion-content">
                <div class="form-group">
                  <label for="headline-input" class="form-label">عنوان الخبر</label>
                  <input type="text" id="headline-input" class="form-input">
                </div>
                <div class="form-group">
                  <label for="newsBody-input" class="form-label">متن الخبر</label>
                  <textarea id="newsBody-input" rows="4" class="form-textarea"></textarea>
                </div>
                 <div class="form-group">
                  <label id="mainImage-drop-area" for="mainImage-input" class="file-input-label">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                    <span>اسحب الصورة هنا أو انقر للاختيار</span>
                  </label>
                  <input type="file" id="mainImage-input" accept="image/png, image/jpeg, image/webp" class="hidden">
                </div>
              </div>
            </details>
            
            <!-- Accordion: Text Styling -->
             <details class="accordion-item">
              <summary class="accordion-summary">
                <span class="flex items-center gap-2">
                  <svg class="icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                  <span>تصميم النصوص</span>
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </summary>
              <div class="accordion-content">
                <div class="form-group">
                  <label for="fontFamily-input" class="form-label">نوع الخط</label>
                  <select id="fontFamily-input" class="form-select">
                    <option value="Cairo">Cairo</option>
                    <option value="Tajawal">Tajawal</option>
                    <option value="Almarai">Almarai</option>
                  </select>
                </div>
                <div class="grid-cols-2">
                  <div class="form-group">
                      <label for="headlineColor-input" class="form-label">لون العنوان</label>
                      <input type="color" id="headlineColor-input" class="color-input">
                  </div>
                  <div class="form-group">
                      <label for="newsBodyColor-input" class="form-label">لون المتن</label>
                      <input type="color" id="newsBodyColor-input" class="color-input">
                  </div>
                </div>
                <div class="form-group">
                    <label for="headlineSize-input" class="form-label">حجم العنوان (<span id="headlineSize-value">40</span>px)</label>
                    <input type="range" id="headlineSize-input" min="20" max="80" class="range-input">
                </div>
                <div class="form-group">
                    <label for="newsBodySize-input" class="form-label">حجم المتن (<span id="newsBodySize-value">20</span>px)</label>
                    <input type="range" id="newsBodySize-input" min="12" max="40" class="range-input">
                </div>
                <div class="text-shadow-section">
                   <h4 class="form-label">ظل العنوان</h4>
                   <div class="text-shadow-control">
                      <input type="color" id="headlineShadowColor-input" class="color-input w-10 h-10 p-1">
                      <div class="flex-grow">
                        <label class="form-label">التمويه: <span id="headlineShadowBlur-value">5</span>px</label>
                        <input type="range" min="0" max="20" id="headlineShadowBlur-input" class="range-input">
                      </div>
                   </div>
                </div>
                <div class="text-shadow-section">
                   <h4 class="form-label">ظل المتن</h4>
                   <div class="text-shadow-control">
                      <input type="color" id="newsBodyShadowColor-input" class="color-input w-10 h-10 p-1">
                      <div class="flex-grow">
                         <label class="form-label">التمويه: <span id="newsBodyShadowBlur-value">3</span>px</label>
                        <input type="range" min="0" max="20" id="newsBodyShadowBlur-input" class="range-input">
                      </div>
                   </div>
                </div>
              </div>
            </details>

            <!-- Accordion: Logo Styling -->
            <details class="accordion-item">
              <summary class="accordion-summary">
                <span class="flex items-center gap-2">
                  <svg class="icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                  <span>تصميم الشعار</span>
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </summary>
              <div class="accordion-content">
                <div class="form-group">
                   <label for="logoImage-input" class="file-input-label file-input-label-small">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                    <span>تغيير الشعار</span>
                  </label>
                  <input type="file" id="logoImage-input" accept="image/png, image/jpeg, image/webp" class="hidden">
                </div>
                <div class="form-group">
                  <label for="logoSize-input" class="form-label">حجم الشعار (<span id="logoSize-value">80</span>px)</label>
                  <input type="range" id="logoSize-input" min="40" max="150" class="range-input">
                </div>
                <div class="form-group">
                  <label for="logoPadding-input" class="form-label">تبطين الشعار (<span id="logoPadding-value">8</span>px)</label>
                  <input type="range" id="logoPadding-input" min="0" max="24" class="range-input">
                </div>
                <div class="form-group">
                  <label for="logoBorderRadius-input" class="form-label">استدارة الحواف (<span id="logoBorderRadius-value">12</span>px)</label>
                  <input type="range" id="logoBorderRadius-input" min="0" max="75" class="range-input">
                </div>
                <div class="form-group">
                  <label class="form-label">موضع الشعار</label>
                  <div class="grid-cols-2 gap-2" id="logoPosition-buttons">
                    <button data-position="top-right" class="btn btn-primary btn-sm">أعلى اليمين</button>
                    <button data-position="top-left" class="btn btn-secondary btn-sm">أعلى اليسار</button>
                    <button data-position="bottom-right" class="btn btn-secondary btn-sm">أسفل اليمين</button>
                    <button data-position="bottom-left" class="btn btn-secondary btn-sm">أسفل اليسار</button>
                  </div>
                </div>
              </div>
            </details>

            <!-- Accordion: Background Palettes -->
             <details class="accordion-item">
              <summary class="accordion-summary">
                <span class="flex items-center gap-2">
                  <svg class="icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h14a2 2 0 012 2v12a4 4 0 01-4 4H7z"></path></svg>
                  <span>تصميم الخلفية</span>
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </summary>
              <div id="palettes-container" class="accordion-content space-y-3">
                <!-- Palettes will be dynamically inserted here -->
              </div>
            </details>

          </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel-wrapper">
          <div 
            id="image-preview"
            class="image-preview">
            
            <div class="preview-section-box">
              <h2 id="preview-headline" class="preview-headline"></h2>
            </div>
            
            <div class="divider"></div>

            <div class="main-image-container">
                 <img id="preview-mainImage" alt="News image" class="preview-main-image">
                 
                 <div id="preview-logo-container" class="logo-container">
                     <img id="preview-logo" alt="Logo" class="preview-logo">
                 </div>
                 <div id="preview-mainImage-placeholder" class="main-image-placeholder hidden">
                     <span>اختر صورة للخبر</span>
                  </div>
            </div>
            
            <div class="divider"></div>

             <div class="preview-section-box">
              <p id="preview-newsBody" class="preview-body"></p>
            </div>

            <!-- Like & Subscribe CTA -->
            <div class="cta-container">
                <div class="cta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 icon-heart" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-shadow-effect">إعجاب</span>
                </div>
                <div class="cta-divider"></div>
                <div class="cta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 icon-star" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <span class="text-shadow-effect">اشتراك</span>
                </div>
            </div>
          </div>

          <button id="export-button" class="export-btn">
              <span id="export-button-content">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                <span>تصدير الصورة</span>
              </span>
              <span id="export-button-loading" class="hidden">
                 <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>جاري التصدير...</span>
              </span>
          </button>
        </div>
      </div>
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE ---
        const state = {
            headline: 'هنا يكتب عنوان الخبر الرئيسي',
            newsBody: 'تفاصيل موجزة عن الخبر لجذب المشاهد. يجب أن تكون قصيرة وواضحة.',
            mainImageUrl: 'https://picsum.photos/720/720',
            logoImageUrl: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48cGF0aCBkPSJNMTIgMjJWMk0yIDEyaDIwTTUuNSAxOC41QTkgOSAwIDAgMCAxMiAyMiA5IDkgMCAwIDAgMTguNSA1LjUuMTgyODEgMTguNSIvPjwvc3ZnPg==',
            headlineColor: '#FFFFFF',
            headlineSize: 23,
            newsBodyColor: '#E0E0E0',
            newsBodySize: 18,
            logoPosition: 'top-right',
            logoSize: 66,
            logoPadding: 2,
            logoBorderRadius: 8,
            fontFamily: 'Cairo',
            headlineShadowColor: '#000000',
            headlineShadowBlur: 5,
            newsBodyShadowColor: '#000000',
            newsBodyShadowBlur: 3,
            isExporting: false,
            activePalette: null
        };

       const palettes = [
    // لوحات مستوحاة من الطبيعة والظواهر الكونية
    { name: 'فجر المحيط الهادئ', css: 'linear-gradient(to right top, #051937, #004d7a, #008793, #00bf72, #a8eb12)' },
    { name: 'أضواء الشفق القطبي', css: 'linear-gradient(to right top, #0f0c29, #3a416a, #76788b, #b7b7a4, #fdf8f4)' },
    { name: 'عمق الغابة المطيرة', css: 'linear-gradient(to right top, #003300, #005000, #006b00, #008900, #00a800)' },
    { name: 'غبار النجوم الكوني', css: 'radial-gradient(ellipse at center, #1b0636 0%, #000000 100%)' },
    { name: 'صحراء المغرب', css: 'linear-gradient(to right top, #6b2e0f, #944618, #be6323, #eb8230, #ff9f3f)' },

    // لوحات عصرية وتصميمية
    { name: 'نيون مدينة المستقبل', css: 'linear-gradient(45deg, #FF00FF 0%, #00FFFF 100%)' },
    { name: 'أناقة المونوكروم', css: 'linear-gradient(to right, #333333, #888888)' },
    { name: 'طيف البكسل', css: 'linear-gradient(135deg, #4A00E0 0%, #8E2DE2 100%)' },
    { name: 'فخامة الرخام الأسود', css: 'radial-gradient(ellipse at top left, rgba(0,0,0,0.8) 0%, rgba(50,50,50,0.9) 100%)' },
    { name: 'هندسة الجليد', css: 'linear-gradient(to right top, #74ebd5, #9face6)' },

    // لوحات درامية ومزاجية
    { name: 'ظل الغموض', css: 'linear-gradient(180deg, #1A1A2E 0%, #0F0F1A 100%)' },
    { name: 'نار التنين', css: 'linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%)' },
    { name: 'هدوء منتصف الليل', css: 'linear-gradient(to right, #2c3e50, #000000)' },
    { name: 'عاصفة الصحراء', css: 'linear-gradient(to right top, #a86b3a, #bf7c47, #d78d55, #f09f63, #ffb272)' },
    { name: 'كهف الكريستال', css: 'linear-gradient(135deg, #1b0042 0%, #52006A 100%)' },

    // لوحات مشرقة وحيوية
    { name: 'انفجار الألوان', css: 'radial-gradient(circle at top right, #ffbe0b, #fb5607, #ff006e, #8338ec, #3a86ff)' },
    { name: 'صيف استوائي', css: 'linear-gradient(to right top, #00b09b, #96c93d)' },
    { name: 'حقل الخزامى', css: 'linear-gradient(135deg, #A74AC7 0%, #F5B0F5 100%)' },

    // اللوحة التي طلبت الاحتفاظ بها
    { name: 'سيان حيوي (أزرق مخضر)', css: 'linear-gradient(45deg, #004d40 0%, #009688 100%)' }
];
        state.activePalette = palettes[0];

        // --- DOM ELEMENTS ---
        const dom = {
            // Inputs
            headlineInput: document.getElementById('headline-input'),
            newsBodyInput: document.getElementById('newsBody-input'),
            mainImageInput: document.getElementById('mainImage-input'),
            mainImageDropArea: document.getElementById('mainImage-drop-area'), // New
            fontFamilyInput: document.getElementById('fontFamily-input'),
            headlineColorInput: document.getElementById('headlineColor-input'),
            newsBodyColorInput: document.getElementById('newsBodyColor-input'),
            headlineSizeInput: document.getElementById('headlineSize-input'),
            newsBodySizeInput: document.getElementById('newsBodySize-input'),
            headlineShadowColorInput: document.getElementById('headlineShadowColor-input'),
            headlineShadowBlurInput: document.getElementById('headlineShadowBlur-input'),
            newsBodyShadowColorInput: document.getElementById('newsBodyShadowColor-input'),
            newsBodyShadowBlurInput: document.getElementById('newsBodyShadowBlur-input'),
            logoImageInput: document.getElementById('logoImage-input'),
            logoSizeInput: document.getElementById('logoSize-input'),
            logoPaddingInput: document.getElementById('logoPadding-input'),
            logoBorderRadiusInput: document.getElementById('logoBorderRadius-input'),
            logoPositionButtons: document.getElementById('logoPosition-buttons'),
            palettesContainer: document.getElementById('palettes-container'),
            exportButton: document.getElementById('export-button'),
            exportButtonContent: document.getElementById('export-button-content'),
            exportButtonLoading: document.getElementById('export-button-loading'),

            // Range Value Labels
            headlineSizeValue: document.getElementById('headlineSize-value'),
            newsBodySizeValue: document.getElementById('newsBodySize-value'),
            headlineShadowBlurValue: document.getElementById('headlineShadowBlur-value'),
            newsBodyShadowBlurValue: document.getElementById('newsBodyShadowBlur-value'),
            logoSizeValue: document.getElementById('logoSize-value'),
            logoPaddingValue: document.getElementById('logoPadding-value'),
            logoBorderRadiusValue: document.getElementById('logoBorderRadius-value'),

            // Preview
            imagePreview: document.getElementById('image-preview'),
            previewHeadline: document.getElementById('preview-headline'),
            previewNewsBody: document.getElementById('preview-newsBody'),
            previewMainImage: document.getElementById('preview-mainImage'),
            previewMainImagePlaceholder: document.getElementById('preview-mainImage-placeholder'),
            previewLogoContainer: document.getElementById('preview-logo-container'),
            previewLogo: document.getElementById('preview-logo')
        };
        
        // --- RENDER/UPDATE FUNCTION ---
        function updatePreview() {
            // Content
            dom.previewHeadline.textContent = state.headline;
            dom.previewNewsBody.textContent = state.newsBody;

            // Images
            if (state.mainImageUrl) {
                dom.previewMainImage.src = state.mainImageUrl;
                dom.previewMainImage.classList.remove('hidden');
                dom.previewMainImagePlaceholder.classList.add('hidden');
            } else {
                dom.previewMainImage.src = '';
                dom.previewMainImage.classList.add('hidden');
                dom.previewMainImagePlaceholder.classList.remove('hidden');
            }

            if (state.logoImageUrl) {
                dom.previewLogo.src = state.logoImageUrl;
                dom.previewLogoContainer.classList.remove('hidden');
            } else {
                dom.previewLogoContainer.classList.add('hidden');
            }
            
            // Text Styles
            dom.imagePreview.style.fontFamily = state.fontFamily;
            dom.previewHeadline.style.color = state.headlineColor;
            dom.previewHeadline.style.fontSize = `${state.headlineSize}px`;
            dom.previewHeadline.style.textShadow = `0px 2px ${state.headlineShadowBlur}px ${state.headlineShadowColor}`;
            
            dom.previewNewsBody.style.color = state.newsBodyColor;
            dom.previewNewsBody.style.fontSize = `${state.newsBodySize}px`;
            dom.previewNewsBody.style.textShadow = `0px 1px ${state.newsBodyShadowBlur}px ${state.newsBodyShadowColor}`;
            
            // Logo Styles
            // Clear existing position classes
            dom.previewLogoContainer.classList.remove('top-left', 'top-right', 'bottom-left', 'bottom-right');
            // Add new position class
            dom.previewLogoContainer.classList.add(state.logoPosition);

            dom.previewLogoContainer.style.width = `${state.logoSize}px`;
            dom.previewLogoContainer.style.height = `${state.logoSize}px`;
            dom.previewLogoContainer.style.padding = `${state.logoPadding}px`;
            dom.previewLogoContainer.style.borderRadius = `${state.logoBorderRadius}px`;

            // Background
            dom.imagePreview.style.background = state.activePalette.css;
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            // --- INPUTS ---
            dom.headlineInput.addEventListener('input', (e) => { state.headline = e.target.value; updatePreview(); });
            dom.newsBodyInput.addEventListener('input', (e) => { state.newsBody = e.target.value; updatePreview(); });
            dom.fontFamilyInput.addEventListener('change', (e) => { state.fontFamily = e.target.value; updatePreview(); });
            dom.headlineColorInput.addEventListener('input', (e) => { state.headlineColor = e.target.value; updatePreview(); });
            dom.newsBodyColorInput.addEventListener('input', (e) => { state.newsBodyColor = e.target.value; updatePreview(); });
            dom.headlineShadowColorInput.addEventListener('input', (e) => { state.headlineShadowColor = e.target.value; updatePreview(); });
            dom.newsBodyShadowColorInput.addEventListener('input', (e) => { state.newsBodyShadowColor = e.target.value; updatePreview(); });

            // --- RANGES ---
            const rangeInputs = [
                { input: dom.headlineSizeInput, stateKey: 'headlineSize', label: dom.headlineSizeValue },
                { input: dom.newsBodySizeInput, stateKey: 'newsBodySize', label: dom.newsBodySizeValue },
                { input: dom.headlineShadowBlurInput, stateKey: 'headlineShadowBlur', label: dom.headlineShadowBlurValue },
                { input: dom.newsBodyShadowBlurInput, stateKey: 'newsBodyShadowBlur', label: dom.newsBodyShadowBlurValue },
                { input: dom.logoSizeInput, stateKey: 'logoSize', label: dom.logoSizeValue },
                { input: dom.logoPaddingInput, stateKey: 'logoPadding', label: dom.logoPaddingValue },
                { input: dom.logoBorderRadiusInput, stateKey: 'logoBorderRadius', label: dom.logoBorderRadiusValue },
            ];
            rangeInputs.forEach(({input, stateKey, label}) => {
                input.addEventListener('input', (e) => {
                    const value = Number(e.target.value);
                    state[stateKey] = value;
                    if (label) label.textContent = value;
                    updatePreview();
                });
            });

            // --- FILES (CLICK & DRAG/DROP) ---
            dom.mainImageInput.addEventListener('change', (e) => handleFile(e.target.files[0], (url) => { state.mainImageUrl = url; updatePreview(); }));
            dom.logoImageInput.addEventListener('change', (e) => handleFile(e.target.files[0], (url) => { state.logoImageUrl = url; updatePreview(); }));

            // Drag and Drop for main image
            dom.mainImageDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dom.mainImageDropArea.classList.add('file-input-label-hover'); // Use custom CSS classes if defined
            });
            dom.mainImageDropArea.addEventListener('dragleave', (e) => {
                dom.mainImageDropArea.classList.remove('file-input-label-hover');
            });
            dom.mainImageDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dom.mainImageDropArea.classList.remove('file-input-label-hover');
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('image/')) {
                    handleFile(files[0], (url) => { state.mainImageUrl = url; updatePreview(); });
                } else {
                    alert("الرجاء إسقاط ملف صورة صالح.");
                }
            });


            // --- BUTTONS ---
            dom.logoPositionButtons.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (button && button.dataset.position) {
                    state.logoPosition = button.dataset.position;
                    // Update button styles using custom classes
                    dom.logoPositionButtons.querySelectorAll('button').forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-secondary');
                    });
                    button.classList.add('btn-primary');
                    button.classList.remove('btn-secondary');
                    updatePreview();
                }
            });

            dom.palettesContainer.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (button && button.dataset.name) {
                    const foundPalette = palettes.find(p => p.name === button.dataset.name);
                    if (foundPalette) {
                        state.activePalette = foundPalette;
                        dom.palettesContainer.querySelectorAll('button').forEach(btn => {
                            btn.classList.remove('palette-btn-active');
                            btn.classList.add('palette-btn-default');
                        });
                        button.classList.add('palette-btn-active');
                        button.classList.remove('palette-btn-default');
                        updatePreview();
                    }
                }
            });

            dom.exportButton.addEventListener('click', exportImage);
        }

        // --- HELPERS ---
        function handleFile(file, callback) {
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => callback(e.target.result);
                reader.readAsDataURL(file);
            }
        }

        async function exportImage() {
            if (state.isExporting) return;
            state.isExporting = true;
            dom.exportButton.disabled = true;
            dom.exportButtonContent.classList.add('hidden');
            dom.exportButtonLoading.classList.remove('hidden');

            try {
                // تأكد أن html2canvas متاح عالميًا
                if (typeof html2canvas === 'undefined') {
                    throw new Error("html2canvas library is not loaded.");
                }
                const canvas = await html2canvas(dom.imagePreview, { 
                    useCORS: true, 
                    allowTaint: true,
                    scale: 2 // Increase resolution for better quality
                });
                const link = document.createElement('a');
                link.download = `short-image-${Date.now()}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();
            } catch (error) {
                console.error("Error exporting image:", error);
                alert("حدث خطأ أثناء تصدير الصورة. يرجى المحاولة مرة أخرى.");
            } finally {
                state.isExporting = false;
                dom.exportButton.disabled = false;
                dom.exportButtonContent.classList.remove('hidden');
                dom.exportButtonLoading.classList.add('hidden');
            }
        }

        function renderPalettes() {
            const html = palettes.map(palette => `
                <button 
                  data-name="${palette.name}"
                  class="palette-btn ${palette.name === state.activePalette.name ? 'palette-btn-active' : 'palette-btn-default'}">
                  <div class="palette-color-box" style="background: ${palette.css}"></div>
                  <span class="palette-name">${palette.name}</span>
                </button>
            `).join('');
            dom.palettesContainer.innerHTML = html;
        }

        function initializeInputs() {
            dom.headlineInput.value = state.headline;
            dom.newsBodyInput.value = state.newsBody;
            dom.fontFamilyInput.value = state.fontFamily;
            dom.headlineColorInput.value = state.headlineColor;
            dom.newsBodyColorInput.value = state.newsBodyColor;
            dom.headlineSizeInput.value = state.headlineSize;
            dom.newsBodySizeInput.value = state.newsBodySize;
            dom.headlineShadowColorInput.value = state.headlineShadowColor;
            dom.newsBodyShadowBlurInput.value = state.newsBodyShadowBlur;
            dom.logoSizeInput.value = state.logoSize;
            dom.logoPaddingInput.value = state.logoPadding;
            dom.logoBorderRadiusInput.value = state.logoBorderRadius;
            dom.headlineShadowColorInput.value = state.headlineShadowColor;
            dom.newsBodyShadowColorInput.value = state.newsBodyShadowColor;

            // Initialize range value labels
            dom.headlineSizeValue.textContent = state.headlineSize;
            dom.newsBodySizeValue.textContent = state.newsBodySize;
            dom.headlineShadowBlurValue.textContent = state.headlineShadowBlur;
            dom.newsBodyShadowBlurValue.textContent = state.newsBodyShadowBlur;
            dom.logoSizeValue.textContent = state.logoSize;
            dom.logoPaddingValue.textContent = state.logoPadding;
            dom.logoBorderRadiusValue.textContent = state.logoBorderRadius;

            // Initialize logo position button style
            dom.logoPositionButtons.querySelectorAll('button').forEach(btn => {
                if (btn.dataset.position === state.logoPosition) {
                    btn.classList.add('btn-primary');
                    btn.classList.remove('btn-secondary');
                } else {
                    btn.classList.add('btn-secondary');
                    btn.classList.remove('btn-primary');
                }
            });
        }

        // --- INITIALIZATION ---
        initializeInputs();
        renderPalettes();
        setupEventListeners();
        updatePreview();
    });
  </script>
</body>
</html>
