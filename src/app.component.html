<main class="min-h-screen bg-gray-900 text-gray-100 p-4 sm:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    <header class="text-center mb-8">
      <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300">
        صانع صور الشورتس الإخبارية
      </h1>
      <p class="mt-2 text-lg text-gray-400">
        أنشئ صورًا احترافية وجذابة لفيديوهاتك القصيرة بسهولة.
      </p>
    </header>

    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Controls Panel -->
      <div class="w-full lg:w-1/3 bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
        <h2 class="text-2xl font-bold mb-4">لوحة التحكم</h2>
        
        <div class="space-y-3">
          <!-- Accordion: Content -->
          <details class="bg-gray-700/50 rounded-lg overflow-hidden" open>
            <summary class="p-4 font-semibold cursor-pointer flex justify-between items-center">
              <span>المحتوى</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </summary>
            <div class="p-4 border-t border-gray-600 space-y-4">
              <div>
                <label for="headline" class="block text-sm font-medium text-gray-300 mb-1">عنوان الخبر</label>
                <input type="text" id="headline" [value]="headline()" (input)="handleTextInput($event, headline)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 transition">
              </div>
              <div>
                <label for="newsBody" class="block text-sm font-medium text-gray-300 mb-1">متن الخبر</label>
                <textarea id="newsBody" [value]="newsBody()" (input)="handleTextInput($event, newsBody)" rows="4" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
              </div>
               <div>
                <label for="mainImage" class="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md cursor-pointer transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                  <span>تغيير صورة الخبر</span>
                </label>
                <input type="file" id="mainImage" (change)="handleFile($event, mainImageUrl)" accept="image/png, image/jpeg, image/webp" class="hidden">
              </div>
            </div>
          </details>
          
          <!-- Accordion: Text Styling -->
           <details class="bg-gray-700/50 rounded-lg overflow-hidden">
            <summary class="p-4 font-semibold cursor-pointer flex justify-between items-center">
              <span>تصميم النصوص</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </summary>
            <div class="p-4 border-t border-gray-600 space-y-4">
              <div>
                <label for="fontFamily" class="block text-sm font-medium text-gray-300 mb-1">نوع الخط</label>
                <select id="fontFamily" [value]="fontFamily()" (change)="handleSelectInput($event, fontFamily)" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 transition">
                  <option value="Cairo">Cairo</option>
                  <option value="Tajawal">Tajawal</option>
                  <option value="Almarai">Almarai</option>
                </select>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="headlineColor" class="block text-sm font-medium text-gray-300 mb-1">لون العنوان</label>
                    <input type="color" id="headlineColor" [value]="headlineColor()" (input)="handleColorInput($event, headlineColor)" class="w-full h-10 p-1 bg-gray-700 border border-gray-600 rounded-md cursor-pointer">
                </div>
                <div>
                    <label for="newsBodyColor" class="block text-sm font-medium text-gray-300 mb-1">لون المتن</label>
                    <input type="color" id="newsBodyColor" [value]="newsBodyColor()" (input)="handleColorInput($event, newsBodyColor)" class="w-full h-10 p-1 bg-gray-700 border border-gray-600 rounded-md cursor-pointer">
                </div>
              </div>
              <div>
                  <label for="headlineSize" class="block text-sm font-medium text-gray-300 mb-1">حجم العنوان ({{ headlineSize() }}px)</label>
                  <input type="range" id="headlineSize" min="20" max="80" [value]="headlineSize()" (input)="handleRangeInput($event, headlineSize)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              </div>
              <div>
                  <label for="newsBodySize" class="block text-sm font-medium text-gray-300 mb-1">حجم المتن ({{ newsBodySize() }}px)</label>
                  <input type="range" id="newsBodySize" min="12" max="40" [value]="newsBodySize()" (input)="handleRangeInput($event, newsBodySize)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              </div>
              <div class="border-t border-gray-600 pt-4 space-y-4">
                 <h4 class="text-md font-semibold">ظل العنوان</h4>
                 <div class="flex items-center gap-4">
                    <input type="color" [value]="headlineShadowColor()" (input)="handleColorInput($event, headlineShadowColor)" class="w-10 h-10 p-1 bg-gray-700 border border-gray-600 rounded-md cursor-pointer">
                    <div class="flex-grow">
                      <label class="text-xs text-gray-400">التمويه: {{headlineShadowBlur()}}px</label>
                      <input type="range" min="0" max="20" [value]="headlineShadowBlur()" (input)="handleRangeInput($event, headlineShadowBlur)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                    </div>
                 </div>
              </div>
              <div class="border-t border-gray-600 pt-4 space-y-4">
                 <h4 class="text-md font-semibold">ظل المتن</h4>
                 <div class="flex items-center gap-4">
                    <input type="color" [value]="newsBodyShadowColor()" (input)="handleColorInput($event, newsBodyShadowColor)" class="w-10 h-10 p-1 bg-gray-700 border border-gray-600 rounded-md cursor-pointer">
                    <div class="flex-grow">
                       <label class="text-xs text-gray-400">التمويه: {{newsBodyShadowBlur()}}px</label>
                      <input type="range" min="0" max="20" [value]="newsBodyShadowBlur()" (input)="handleRangeInput($event, newsBodyShadowBlur)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                    </div>
                 </div>
              </div>
            </div>
          </details>

          <!-- Accordion: Logo Styling -->
          <details class="bg-gray-700/50 rounded-lg overflow-hidden">
            <summary class="p-4 font-semibold cursor-pointer flex justify-between items-center">
              <span>تصميم الشعار</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </summary>
            <div class="p-4 border-t border-gray-600 space-y-4">
              <div>
                 <label for="logoImage" class="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md cursor-pointer transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                  <span>تغيير الشعار</span>
                </label>
                <input type="file" id="logoImage" (change)="handleFile($event, logoImageUrl)" accept="image/png, image/jpeg, image/webp" class="hidden">
              </div>
              <div>
                <label for="logoSize" class="block text-sm font-medium text-gray-300 mb-1">حجم الشعار ({{ logoSize() }}px)</label>
                <input type="range" id="logoSize" min="40" max="150" [value]="logoSize()" (input)="handleRangeInput($event, logoSize)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              </div>
              <div>
                <label for="logoPadding" class="block text-sm font-medium text-gray-300 mb-1">تبطين الشعار ({{ logoPadding() }}px)</label>
                <input type="range" id="logoPadding" min="0" max="24" [value]="logoPadding()" (input)="handleRangeInput($event, logoPadding)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              </div>
              <div>
                <label for="logoBorderRadius" class="block text-sm font-medium text-gray-300 mb-1">استدارة الحواف ({{ logoBorderRadius() }}px)</label>
                <input type="range" id="logoBorderRadius" min="0" max="75" [value]="logoBorderRadius()" (input)="handleRangeInput($event, logoBorderRadius)" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">موضع الشعار</label>
                <div class="grid grid-cols-2 gap-2">
                  <button (click)="setLogoPosition('top-right')" [class]="logoPosition() === 'top-right' ? 'bg-blue-600' : 'bg-gray-700'" class="p-2 rounded-md text-xs transition">أعلى اليمين</button>
                  <button (click)="setLogoPosition('top-left')" [class]="logoPosition() === 'top-left' ? 'bg-blue-600' : 'bg-gray-700'" class="p-2 rounded-md text-xs transition">أعلى اليسار</button>
                  <button (click)="setLogoPosition('bottom-right')" [class]="logoPosition() === 'bottom-right' ? 'bg-blue-600' : 'bg-gray-700'" class="p-2 rounded-md text-xs transition">أسفل اليمين</button>
                  <button (click)="setLogoPosition('bottom-left')" [class]="logoPosition() === 'bottom-left' ? 'bg-blue-600' : 'bg-gray-700'" class="p-2 rounded-md text-xs transition">أسفل اليسار</button>
                </div>
              </div>
            </div>
          </details>

          <!-- Accordion: Background Palettes -->
           <details class="bg-gray-700/50 rounded-lg overflow-hidden">
            <summary class="p-4 font-semibold cursor-pointer flex justify-between items-center">
              <span>تصميم الخلفية</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </summary>
            <div class="p-4 border-t border-gray-600 space-y-2">
              @for (palette of palettes(); track palette.name) {
                <button 
                  (click)="setActivePalette(palette)" 
                  class="flex items-center gap-3 w-full p-2 rounded-lg transition"
                  [class]="activePalette() === palette ? 'bg-blue-600/50 ring-2 ring-blue-400' : 'bg-gray-700 hover:bg-gray-600/50'">
                  <div class="w-8 h-8 rounded-md border border-white/20 shrink-0" [style.background]="palette.css"></div>
                  <span class="text-sm font-medium">{{ palette.name }}</span>
                </button>
              }
            </div>
          </details>

        </div>
      </div>

      <!-- Preview Panel -->
      <div class="w-full lg:w-2/3 flex flex-col items-center justify-center">
        <div 
          #imagePreview 
          class="w-full max-w-[405px] aspect-[9/16] overflow-hidden shadow-2xl flex flex-col justify-start p-6 sm:p-8 gap-3 transition-all duration-500"
          [style.background]="activePalette().css"
          [style.font-family]="fontFamily()">
          
          <div class="bg-black/50 backdrop-blur-sm p-3 rounded-lg shadow-lg">
            <h2 
              class="font-black text-center w-full"
              [style.color]="headlineColor()"
              [style.font-size.px]="headlineSize()"
              [style.text-shadow]="headlineTextShadow()">
                {{ headline() }}
            </h2>
          </div>
          
          <div class="h-px w-1/2 mx-auto bg-blue-400/30"></div>

          <div class="relative w-full my-auto flex-grow rounded-xl overflow-hidden bg-gray-700/50 border-2 border-gray-700/50 shadow-md">
             @if (mainImageUrl()) {
               <img 
                [src]="mainImageUrl()" 
                alt="News image" 
                class="absolute inset-0 w-full h-full object-cover transition-all">
               
               @if (logoImageUrl()) {
                 <div 
                   class="absolute flex items-center justify-center bg-black/30 backdrop-blur-sm shadow-xl border-2 border-white/20 transition-all duration-300"
                   [class]="getLogoPositionClasses()"
                   [style.width.px]="logoSize()"
                   [style.height.px]="logoSize()"
                   [style.padding.px]="logoPadding()"
                   [style.border-radius.px]="logoBorderRadius()">
                   <img [src]="logoImageUrl()" alt="Logo" class="w-full h-full object-contain drop-shadow-lg">
                 </div>
               }
             } @else {
                <div class="w-full h-full flex items-center justify-center text-gray-500 text-center p-4">
                   <span>اختر صورة للخبر</span>
                </div>
             }
          </div>
          
          <div class="h-px w-1/2 mx-auto bg-blue-400/30"></div>

           <div class="bg-black/50 backdrop-blur-sm p-3 rounded-lg shadow-lg">
            <p 
              class="font-medium text-center w-full"
              [style.color]="newsBodyColor()"
              [style.font-size.px]="newsBodySize()"
              [style.text-shadow]="newsBodyTextShadow()">
                {{ newsBody() }}
            </p>
          </div>

          <!-- Like & Subscribe CTA -->
          <div class="mt-auto flex items-center justify-center gap-4 text-white font-semibold text-sm pt-4">
              <div class="flex items-center gap-1.5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                  </svg>
                  <span style="text-shadow: 0 1px 3px rgba(0,0,0,0.5);">إعجاب</span>
              </div>
              <div class="h-5 w-px bg-white/30"></div>
              <div class="flex items-center gap-1.5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                  <span style="text-shadow: 0 1px 3px rgba(0,0,0,0.5);">اشتراك</span>
              </div>
          </div>
        </div>

        <button 
          (click)="exportImage()" 
          [disabled]="isExporting()"
          class="mt-6 w-full max-w-[405px] bg-gradient-to-r from-blue-500 to-teal-400 text-white font-bold py-3 px-6 rounded-lg text-lg hover:from-blue-600 hover:to-teal-500 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
            @if (isExporting()) {
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span>جاري التصدير...</span>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              <span>تصدير الصورة</span>
            }
        </button>
      </div>
    </div>
  </div>
</main>